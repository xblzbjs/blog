+++
title = "优雅的查看文件内容"
date = "2021-07-06"
author = "xblzbjs"
tags = [
  "Linux",
]
+++

Linux 下查阅文件内容，可以根据不同场景选择不同的指令。

### cat

当文件较小时，比如一个配置文件，想要快速浏览这个文件，可以用cat指令。下面 cat 指令帮助我们快速查看/etc/hosts文件。cat指令将文件连接到标准输出流并打印到屏幕上。

```shell
cat /etc/hosts	
```

标准输出流（Standard Output）也是一种文件，进程可以将要输出的内容写入标准输出流文件，这样就可以在屏幕中打印。

如果用cat查看大文件，比如一个线上的日志文件，因为动辄有几个 G，控制台打印出所有的内容就要非常久，而且刷屏显示看不到东西。

而且如果在线上进行查看大文件的操作，会带来不必要的麻烦：

- 需要把文件拷贝到输入输出流，这需要花费很长时间，这个过程会占用机器资源；
- 本身文件会读取到内存中，这时内存被大量占用，很危险，这可能导致其他应用内存不足。因此我们需要一些不用加载整个文件，就能查看文件内容的指令。

### more

more可以帮助我们读取文件，但不需要读取整个文件到内存中。本身more的定位是一个阅读过滤器，比如你在more里除了可以向下翻页，还可以输入一段文本进行搜索。

```shell
more <file>
```

### less

less是一个和more功能差不多的工具，打开man能够看到less的介绍上写着自己是more的反义词（opposite of more）。less支持向上翻页，这个功能more是做不到的。所以现在less用得更多一些。

### head/tail

head和tail是一组，它们用来读取一个文件的头部 N 行或者尾部 N 行。比如一个线上的大日志文件，当线上出了 bug，服务暂停的时候，我们就可以用

```shell
tail -n 1000	
```

去查看最后的 1000 行日志文件，寻找导致服务异常的原因。

另一个比较重要的用法是，如果你想看一个实时的nginx日志，可以使用

```shell
tail -f <filename>	# -f 代表follow:文件追加的内容会跟随输出到标准输出流。
```

这样你会看到用户的请求不断进来。

### grep

有时候你需要查看一个指定ip的nginx日志，或者查看一段时间内的nginx日志。如果不想用less和more进入文件中去查看，就可以用grep命令。

grep 这个词，我们分成三段来看，是 g|re|p。

- g 就是 global，全局；
- re 就是 regular expression，正则表达式；
- p 就是 pattern，模式。

所以这个指令的作用是通过正则表达式全局搜索一个文件找到匹配的模式。

下面我们举两个例子看看 grep 的用法：

例 1：通过nginx日志查找 ip 地址

可以通过grep命令定位某个ip地址的用户都做了什么事情，如下图所示：

```shell
grep <ip> <nginx log file>
```

例 2：通过nginx查找时间段的日志

可以通过 grep 命令查找某个时间段内用户都做了什么事情。

```shell
grep 09/May/2021:10:20 <nginx log file> # 查看2021-05-09:10.20 五分钟内所有用户的访问情况
```

